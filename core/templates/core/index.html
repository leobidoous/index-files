{% extends "core/base_view.html" %}
{% load static %}
{% block content %}
    {% if user.is_authenticated %}
        <div class="content-inside">
            <div class="content-filters">
                <form method="get">
                    <fieldset>
                        <div>
                            <h5><b>Procurar arquivos</b></h5>
                            <hr>
                        </div>
                        <div class="form-row">
                            <div class="col-md">
                                <label for="name">Nome do Paciente</label>
                                <input type="text" class="form-control"
                                       placeholder="Informe o nome do paciente"
                                       name="name" {% if filters.name %} value="{{ filters.name }}" {% endif %}
                                       id="name">
                            </div>
                            <div class="col-md">
                                <label for="cpf">Informe o CPF do Paciente</label>
                                <input type="text" class="form-control" placeholder="CPF do paciente"
                                       name="cpf" data-mask="000.000.000-00" {% if filters.cpf %}
                                       value="{{ filters.cpf }}" {% endif %} id="cpf">
                            </div>
                            <div class="col-md">
                                <label for="birth">Data de Nascimento do Paciente</label>
                                <input type="date" class="form-control"
                                       placeholder="Informe a data de nascimento do paciente"
                                       name="birth" {% if filters.birth %} value="{{ filters.birth }}" {% endif %}
                                       id="birth">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col-md">
                                <label for="medical_records_number">Número do Prontuário</label>
                                <input type="text" class="form-control" placeholder="Informe o número do prontuário"
                                       name="medical_records_number" {% if filters.medical_records_number %}
                                       value="{{ filters.medical_records_number }}" {% endif %}
                                       id="medical_records_number">
                            </div>
                            <div class="col-md">
                                <label for="attendance_number">Número do Atendimento</label>
                                <input type="text" class="form-control" placeholder="Informe o número do atendimento"
                                       name="attendance_number" {% if filters.attendance_number %}
                                       value="{{ filters.attendance_number }}" {% endif %} id="attendance_number">
                            </div>
                            <div class="col-md">
                                <label for="sector">Setor</label>
                                <input type="text" class="form-control" placeholder="Informe o setor"
                                       name="attendance_number" {% if filters.sector %}
                                       value="{{ filters.sector }}" {% endif %} id="sector">
                            </div>


                        </div>
                        <div class="form-row">
                            <div style="margin-right: 5px; margin-left: 5px">
                                <a href="{% url 'core:home' %}">
                                    <button class="btn btn-outline-danger" type="button">Limpar</button>
                                </a>

                            </div>
                            <div style="margin-right: 5px; margin-left: 5px">
                                <button class="btn btn-info" type="submit">
                                    Procurar
                                </button>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>

            {% if files %}
                <div class="content-scrolable">
                    <table class="table table-hover table-light ">
                        <thead class="thead-dark">
                        <tr class="content-scrolable">
                            <th scope="col">Arquivo</th>
                            <th class="th-500" scope="col">Nome Beneficiário</th>
                            <th class="th-300" scope="col">Nascimento</th>
                            <th class="th-200" scope="col">Nº Prontuário</th>
                            <th class="th-200" scope="col">Nº Atendimento</th>
                            <th class="th-300" scope="col">Data Entrada</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for file in files %}
                            <tr>
                                <th scope="row" style="color: black">
                                    <a class="glyphicon-link" href="{{ file.url }}" target="_blank">
                                        <svg width="2em" height="1.5em" viewBox="0 0 16 16"
                                             class="bi bi-file-earmark-arrow-down" fill="currentColor"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path d="M4 1h5v1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6h1v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2z"></path>
                                            <path d="M9 4.5V1l5 5h-3.5A1.5 1.5 0 0 1 9 4.5z"></path>
                                            <path fill-rule="evenodd"
                                                  d="M5.646 9.146a.5.5 0 0 1 .708 0L8 10.793l1.646-1.647a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 0-.708z"></path>
                                            <path fill-rule="evenodd"
                                                  d="M8 6a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4A.5.5 0 0 1 8 6z"></path>
                                        </svg>
                                    </a>
                                </th>
                                <td>{% if file.name %} {{ file.name }} {% else %} - {% endif %}</td>
                                <td>{% if file.birth %} {{ file.birth|date:"d/m/Y" }} {% else %} - {% endif %}</td>
                                <td>{% if file.medical_records_number %} {{ file.medical_records_number }} {% else %}
                                    - {% endif %}</td>
                                <td>{% if file.attendance_number %} {{ file.attendance_number }} {% else %}
                                    - {% endif %}</td>
                                <td>{% if file.date_in %}
                                    {{ file.date_in|date:"d/m/Y" }} {% else %} - {% endif %}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}

            {% if not files %}
                <div class="content-scrolable">
                    <table class="table table-hover table-light ">
                        <thead class="thead-dark">
                        <tr class="content-scrolable">
                            <th scope="col">Arquivo</th>
                            <th class="th-500" scope="col">Nome Beneficiário</th>
                            <th class="th-300" scope="col">Nascimento</th>
                            <th class="th-200" scope="col">Nº Prontuário</th>
                            <th class="th-200" scope="col">Nº Atendimento</th>
                            <th class="th-300" scope="col">Data Entrada</th>
                        </tr>
                        </thead>
                    </table>
                </div>
                <div class="content-list-empty" style="background-color: white">
                    <h4>Nenhum arquivo encontrado!</h4>
                </div>
            {% endif %}

            {% if page_obj.has_other_pages %}
                <div class="content-pagination">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            {% if page_obj.has_previous %}
                                {% if page_obj.previous_page_number != 1 %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page=1">Primeira</a>
                                    </li>
                                {% endif %}
                                <li class="page-item">
                                    <a class="page-link"
                                       href="?page={{ page_obj.previous_page_number }}">Anterior</a>
                                </li>
                            {% endif %}
                            {% for i in page_obj.paginator.page_range %}
                                {% if page_obj.number == i %}
                                    <li class="page-item active disabled"><a class="page-link">{{ i }}</a></li>
                                {% else %}
                                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}
                            {% if page_obj.has_next %}
                                {% if page_obj.next_page_number != page_obj.number|add:1 %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Próxima</a>
                                    </li>
                                {% endif %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">
                                        Última
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            {% endif %}

        </div>

    {% else %}
        <meta http-equiv="REFRESH" content="0; url={% url 'core:login' %}">
    {% endif %}
{% endblock %}
